<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø¹Ù…Ø§Ø¯ Ø§Ù„Ø³Ø¹Ø¯ÙŠ Ù„Ù„ÙÙ‡Ø±Ø³Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© | MARC21</title>

<!-- Ù…ÙƒØªØ¨Ø© Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root { --primary:#0f172a; --secondary:#e11d48; --accent:#f59e0b; --success:#10b981; --light:#f1f5f9; --border:#cbd5e1; }

body { font-family:'Segoe UI', Tahoma; background:#f8fafc; margin:0; padding:20px; color:#334155; }

.container { max-width:1550px; margin:auto; background:white; padding:30px; border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.08); border-top:10px solid var(--primary); }

header { text-align:center; margin-bottom:25px; }

.tabs-bar { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
.tabs-bar button { padding:10px 15px; border:none; border-radius:8px; cursor:pointer; background:#e2e8f0; font-weight:bold; }

.tab-content { display:none; }
.tab-content.active { display:block; }

.course-box { background:#f8fafc; padding:20px; border-radius:12px; border:1px solid var(--border); margin-bottom:15px; }

.search-engine { background:var(--primary); padding:20px; border-radius:12px; display:flex; gap:10px; margin-bottom:25px; }
.search-engine input { flex:1; padding:12px; border-radius:6px; border:none; }

.btn-z39 { background:var(--accent); color:black; padding:12px 25px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }

.main-layout { display:grid; grid-template-columns:1fr 420px; gap:30px; }

.toolbar-group { background:var(--light); padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid var(--border); }

.btn-tag { padding:6px 12px; font-size:0.85em; background:white; border:1px solid #94a3b8; border-radius:4px; cursor:pointer; font-weight:600; }

.marc-table { width:100%; border-collapse:collapse; margin-top:10px; }
.marc-table th { background:var(--primary); color:white; padding:10px; }
.marc-table td { border-bottom:1px solid #e2e8f0; padding:8px; }

.tag-input { width:55px; text-align:center; }
.ind-input { width:30px; text-align:center; }
.data-input { width:100%; }

.side-panel { display:flex; flex-direction:column; gap:15px; }

.preview-box { background:#1e293b; color:#38bdf8; padding:20px; border-radius:12px; font-family:monospace; direction:ltr; min-height:350px; white-space:pre-wrap; }

.action-btn { width:100%; padding:14px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; color:white; }

.btn-save { background:#2563eb; }
.btn-excel { background:var(--success); }
.btn-clear { background:var(--secondary); }

.field-select { width:100%; padding:10px; border-radius:6px; font-weight:bold; }
</style>
</head>

<body>

<div class="container">

<header>
<h1>Ù†Ø¸Ø§Ù… Ø¹Ù…Ø§Ø¯ Ø§Ù„Ø³Ø¹Ø¯ÙŠ Ù„Ù„ÙÙ‡Ø±Ø³Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© (MARC21)</h1>
</header>

<!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
<div class="tabs-bar">
<button onclick="showTab('editor')">ğŸ“˜ Ù…Ø­Ø±Ø± MARC</button>
<button onclick="showTab('courses')">ğŸ“ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</button>
</div>

<!-- Ø§Ù„Ù…Ø­Ø±Ø± -->
<div id="editor" class="tab-content active">

<div class="search-engine">
<input type="text" id="queryInput" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨...">
<button class="btn-z39" onclick="fetchDemo()">ğŸ“¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª</button>
</div>

<div class="main-layout">

<div>
<div class="toolbar-group">
<select id="fieldSelector" class="field-select" onchange="addFromSelector()">
<option value="">-- Ø§Ø®ØªØ± Ø­Ù‚Ù„ --</option>
</select>
</div>

<table class="marc-table">
<thead>
<tr><th>Ø§Ù„ØªØ§Ø¬</th><th>Ù…Ø¤Ø´Ø±Ø§Øª</th><th>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</th><th></th></tr>
</thead>
<tbody id="marcBody"></tbody>
</table>
</div>

<div class="side-panel">
<div class="preview-box" id="preview">LDR 00000nam a2200000 i 4500</div>

<button class="action-btn btn-save" onclick="saveRecord()">ğŸ’¾ Ø­ÙØ¸</button>
<button class="action-btn btn-excel" onclick="exportExcel()">ğŸ“Š Excel</button>
<button class="action-btn btn-excel" onclick="exportText()">ğŸ“„ Text</button>
<button class="action-btn btn-clear" onclick="clearForm()">ğŸ”„ ØªÙØ±ÙŠØº</button>
</div>

</div>
</div>

<!-- Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª -->
<div id="courses" class="tab-content">
<div class="course-box">
<h3>Ø§Ù„ÙˆØ­Ø¯Ø© 1: Ù…Ø¯Ø®Ù„ Ø¥Ù„Ù‰ MARC21</h3>
<p>â€¢ Ù…ÙÙ‡ÙˆÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠ</p>
<p>â€¢ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø³Ø¬Ù„</p>
</div>

<div class="course-box">
<h3>Ø§Ù„ÙˆØ­Ø¯Ø© 2: Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
<p>020 â€“ Ø±Ø¯Ù…Ùƒ</p>
<p>100 â€“ Ù…Ø¯Ø®Ù„ Ø±Ø¦ÙŠØ³ÙŠ</p>
<p>245 â€“ Ø¨ÙŠØ§Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</p>
</div>
</div>

</div>

<script>

function showTab(tabId){
document.querySelectorAll('.tab-content').forEach(tab=>tab.classList.remove('active'));
document.getElementById(tabId).classList.add('active');
}

const bibAlexFields = [
{ tag:'020', ind1:'#', ind2:'#', sub:'$a ', label:'020 - Ø±Ø¯Ù…Ùƒ' },
{ tag:'100', ind1:'1', ind2:'#', sub:'$a ', label:'100 - Ù…Ø¤Ù„Ù' },
{ tag:'245', ind1:'1', ind2:'0', sub:'$a $b $c ', label:'245 - Ø¹Ù†ÙˆØ§Ù†' },
{ tag:'264', ind1:'#', ind2:'1', sub:'$a $b $c ', label:'264 - Ù†Ø´Ø±' },
{ tag:'300', ind1:'#', ind2:'#', sub:'$a $b $c ', label:'300 - Ù…Ø§Ø¯ÙŠ' }
];

window.onload = ()=>{
const selector=document.getElementById('fieldSelector');
bibAlexFields.forEach((f,i)=>{
let option=document.createElement('option');
option.value=i;
option.textContent=f.label;
selector.appendChild(option);
});
};

function addRow(tag='',i1='#',i2='#',data=''){
const tbody=document.getElementById('marcBody');
const row=tbody.insertRow();
row.innerHTML=`
<td><input class="tag-input" value="${tag}" oninput="updatePreview()"></td>
<td>
<input class="ind-input" value="${i1}" oninput="updatePreview()">
<input class="ind-input" value="${i2}" oninput="updatePreview()">
</td>
<td><input class="data-input" value="${data}" oninput="updatePreview()"></td>
<td><button onclick="this.parentElement.parentElement.remove();updatePreview()">ğŸ—‘ï¸</button></td>
`;
updatePreview();
}

function addFromSelector(){
const idx=document.getElementById('fieldSelector').value;
if(idx==="") return;
const f=bibAlexFields[idx];
addRow(f.tag,f.ind1,f.ind2,f.sub);
document.getElementById('fieldSelector').value="";
}

function updatePreview(){
let text="LDR 00000nam a2200000 i 4500\n";
document.querySelectorAll('#marcBody tr').forEach(row=>{
const tag=row.querySelector('.tag-input').value;
const inds=row.querySelectorAll('.ind-input');
const data=row.querySelector('.data-input').value;
if(tag) text+=`${tag} ${inds[0].value}${inds[1].value} ${data}\n`;
});
document.getElementById('preview').textContent=text;
}

function fetchDemo(){
clearForm();
addRow('245','1','0','$a Ø¹Ù†ÙˆØ§Ù† ØªØ¬Ø±ÙŠØ¨ÙŠ');
}

function exportExcel(){
let rows=[["Ø§Ù„ØªØ§Ø¬","Ù…1","Ù…2","Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"]];
document.querySelectorAll('#marcBody tr').forEach(tr=>{
const tag=tr.querySelector('.tag-input').value;
const inds=tr.querySelectorAll('.ind-input');
const data=tr.querySelector('.data-input').value;
rows.push([tag,inds[0].value,inds[1].value,data]);
});
const ws=XLSX.utils.aoa_to_sheet(rows);
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"MARC");
XLSX.writeFile(wb,"MARC_Record.xlsx");
}

function exportText(){
const marcText=document.getElementById('preview').textContent;
const blob=new Blob([marcText],{type:"text/plain;charset=utf-8;"});
const link=document.createElement("a");
link.href=URL.createObjectURL(blob);
link.download="MARC_Record.txt";
link.click();
}

function saveRecord(){
localStorage.setItem('last_record',document.getElementById('preview').textContent);
alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
}

function clearForm(){
document.getElementById('marcBody').innerHTML='';
updatePreview();
}

</script>

</body>
</html>
